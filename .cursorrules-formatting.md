# Formatting and File Structure Rules

**CRITICAL: These rules must be checked BEFORE making any code changes.**

---

## File Structure Pattern

All files in this project follow a consistent structure:

```
#region Private Variables
  - All private fields
  - Constants at the end of this region
#endregion

#region Main Methods
  - public override void Create() - if exists
  - Other main initialization methods
#endregion

#region Render Methods
  - public override async Task OnDrawingStepProcessed() - FIRST
  - protected override async Task DrawImage() - SECOND
  - protected override async Task DrawScatterImage() - THIRD
  - protected override async Task DrawGrowthImage() - FOURTH
  - Any other override methods
#endregion

#region Helper Methods (or #region Drawing Methods, etc.)
  - Private helper methods
  - Struct/class definitions used only by this class
#endregion
```

**KEY RULE:** Main override methods ALWAYS come before helper methods in the same region.

---

## Region Order Rules

1. **Private Variables** - Always first
2. **Main Methods** - Initialization methods
3. **Render Methods** - All override methods (main ones first)
4. **Helper Methods** - Private helpers after overrides

**NEVER** put helper methods before main override methods in the same region.

---

## Formatting Consistency

### Spacing and Indentation
- Match the existing file's spacing exactly
- If file uses 2 spaces, use 2 spaces
- If file uses tabs, use tabs
- If file has blank lines between methods, add them

### Comment Style
- Match existing comment style (// vs /* */)
- Match comment placement (above vs inline)
- Don't add comments that don't match the style

### Method Organization
- Group related methods together
- Follow the existing grouping pattern
- If methods are alphabetical, keep alphabetical
- If methods are grouped by functionality, maintain that grouping

---

## Before Editing Any File

**MANDATORY CHECKLIST:**

1. [ ] Read the entire file first
2. [ ] Note the region structure and order
3. [ ] Note where main methods vs helpers are placed
4. [ ] Note spacing/indentation style
5. [ ] Note comment style
6. [ ] Note method grouping pattern
7. [ ] Match ALL of these exactly in your changes

---

## Examples

### ✅ CORRECT Structure

```csharp
#region Render Methods

public override async Task OnDrawingStepProcessed(...)
{
  // main logic
}

protected override async Task DrawImage(...)
{
  // implementation
}

#endregion

#region Helper Methods

private void SomeHelper()
{
  // helper logic
}

#endregion
```

### ❌ WRONG Structure

```csharp
#region Render Methods

private void SomeHelper()  // ❌ Helper before main method
{
  // helper logic
}

public override async Task OnDrawingStepProcessed(...)  // ❌ Main method after helper
{
  // main logic
}

#endregion
```

---

## Struct/Type Definitions

- If used only by this class → Define in Helper Methods region
- If used by multiple classes → Extract to shared location (types/, models/, etc.)

---

END OF FORMATTING RULES
